{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸ“ì—íƒì†Œ:ê²Œì„ê²°ê³¼</title>
    <link rel="stylesheet" href="{% static 'myapp/css/resultlist.css' %}" />
    <script>
      function fetchSeasonResults() {
        const season = document.getElementById("season-select").value;
        fetch(`/resultlist?season=${season}`, {
          headers: {
            "X-Requested-With": "XMLHttpRequest",
          },
        })
          .then((response) => response.json())
          .then((data) => {
            const todayBody = document.querySelector("#today-results tbody");
            const pastBody = document.querySelector("#past-results tbody");
            todayBody.innerHTML = "";
            pastBody.innerHTML = "";
            data.todays_games.forEach((game, index) => {
              let row = createRow(game, index);
              todayBody.appendChild(row);
            });
            data.past_games.forEach((game, index) => {
              let row = createRow(game, index);
              pastBody.appendChild(row);
            });
          })
          .catch((error) => console.error("Error:", error));
      }

      function createRow(game, index) {
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${index + 1}</td>
            <td>${game.datetime}</td>
            <td class="score">${game.player_a}</td>
            <td class="score">${game.score_a}</td>
            <td class="score">${game.score_b}</td>
            <td class="score">${game.player_b}</td>
        `;
        highlightCells(row, game.score_a, game.score_b);
        return row;
      }

      function highlightCells(row, scoreA, scoreB) {
        const scores = row.querySelectorAll(".score");
        if (scoreA > scoreB) {
          scores[0].classList.add("highlight");
          scores[1].classList.add("highlight");
        } else if (scoreB > scoreA) {
          scores[2].classList.add("highlight");
          scores[3].classList.add("highlight");
        }
      }
    </script>
  </head>
  <body onload="fetchSeasonResults();">
    <header>
      <h1>ğŸ“ ê²Œì„ ê²°ê³¼ ğŸ“</h1>
    </header>
    <select id="season-select" onchange="fetchSeasonResults()">
      <option value="all">ì „ì²´ ì‹œì¦Œ</option>
      <option value="1">ì‹œì¦Œ 1</option>
      <option value="2" selected>ì‹œì¦Œ 2</option>
      <option value="3">ì‹œì¦Œ 3</option>
    </select>
    <section>
      <h2>ì˜¤ëŠ˜ì˜ ê²Œì„</h2>
      <table id="today-results" border="1">
        <thead>
          <tr>
            <th>N</th>
            <th>Date</th>
            <th>A</th>
            <th>A</th>
            <th>B</th>
            <th>B</th>
          </tr>
        </thead>
        <tbody>
          <!-- ì˜¤ëŠ˜ì˜ ê²Œì„ ê²°ê³¼ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
        </tbody>
      </table>
    </section>
    <section>
      <h2>ì´ì „ ê²Œì„</h2>
      <table id="past-results" border="1">
        <thead>
          <tr>
            <th>N</th>
            <th>Date</th>
            <th>A</th>
            <th>A</th>
            <th>B</th>
            <th>B</th>
          </tr>
        </thead>
        <tbody>
          <!-- ì´ì „ ê²Œì„ ê²°ê³¼ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
        </tbody>
      </table>
    </section>
    <a href="{% url 'home' %}">í™ˆìœ¼ë¡œ</a>
  </body>
</html>
